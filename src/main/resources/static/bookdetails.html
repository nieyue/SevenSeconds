<!DOCTYPE html>
<html ng-app="detailsApp" ng-controller="detailsCtrl" >
<head>
<title ng-bind="bookChapter.title"></title>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport"
	content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
<meta name="keywords" content="{{bookChapter.title}}">
<meta charset="UTF-8">
<meta name="description"
	content="{{bookChapter.title}}">
	<link rel="shortcut icon" href="http://img.newzhuan.cn/uploaderPath/img/20170907/15047652539005249544896312.png" />
 <link href="https://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
 <link href="https://cdn.bootcss.com/Swiper/4.0.6/css/swiper.min.css" rel="stylesheet">
 <link href="http://www.newzhuan.cn/resources/css/base.css" rel="stylesheet"> 
<!--  
 <link href="http://www.newzhuan.cn/resources/css/bootstrap.min.css" rel="stylesheet">
 <link href="http://www.newzhuan.cn/resources/css/swiper.min.css" rel="stylesheet">
 <link href="http://www.newzhuan.cn/resources/css/base.css" rel="stylesheet">
  -->
<style type="text/css">

#newsDeatilsBody *{
max-width:100% !important;
}
</style>
</head>
<body >
	<div  class="comment-wrap "  >
			<!-- <div class='loadAnimation' style="padding-top:105px !important;width:100%;height:100%;z-index:99999999;position:fixed;left:0;top:0;background:linear-gradient(to bottom, #fff ,#ececec)" > -->
			<div class='loadAnimation' style="padding-top:105px !important;width:100%;height:100%;z-index:99999999;position:fixed;left:0;top:0;background:linear-gradient(to bottom, #fff ,#fff)" >
				<div class="text-center">
				<img alt="" style="width:100%;" src="http://img.newzhuan.cn/uploaderPath/img/20171012/15077771426357259452972994.gif">
				</div>
			</div>
		<!-- 精品推荐 -->
		<div style="padding:0 3%;">
		<div style="display:inline-block;margin-bottom:1px;">
	        <span style="font-weight:bold;font-size:1.1rem">
	        精品推荐
	        </span>
	    </div>
	    <div class="swiper-container" style="margin:auto;text-align:center;">
		    <div class="swiper-wrapper">
				<div  class="listGroup list-group swiper-slide" style="width:30%;display:inline-block;margin:1% 1%;" ng-repeat="recommend2Book in recommend2BookList" on-finish-render-filters  ng-click="clickBook(recommend2Book)">
					<div  style="width:100%;">
					<div class="media-left" style="vertical-align:middle;width:100%;padding-right:0 !important;display:inline-block;">
						 <img class="comment-list-item-img"
							ng-src="{{recommend2Book.imgAddress}}" >
								<span style="font-size:1rem;overflow: hidden;display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;text-overflow:ellipsis;" ng-bind="recommend2Book.title"></span>
						<!-- <a href="#" style="padding:5px 0 !important;position: relative;left: 0;top:0;display:inline-block;width:100%;">
						</a> -->
					</div> 
					</div>
				</div>
		      <div class="swiper-slide"></div>
		    </div>
		 </div>
		</div>			
	    <!-- 精品推荐end -->
		</div>			
		
		<!-- 底部 -->
		<div style="width:100%;height:100px;"></div>
		<!-- 底部 end-->
		<!-- cnzz -->
		<div style="display:none;">
		 <script src="https://s19.cnzz.com/z_stat.php?id=1264381192&web_id=1264381192" language="JavaScript"></script>
		</div>
		
	<!-- <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script> -->
	<!-- <script src="http://www.newzhuan.cn/resources/js/jquery2.1.js"></script>
	<script src="http://www.newzhuan.cn/resources/js/angularjs.min.1.5.7.js"></script>
 	 <script src="http://www.newzhuan.cn/resources/js/swiper.min.js"></script> 
 	 <script src="http://www.newzhuan.cn/resources/js/domainManager.js"></script> 
	<script  src="http://www.newzhuan.cn/resources/js/base.js"></script> -->
	
	<script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/angular.js/1.5.7/angular.min.js"></script>
 	 <script src="https://cdn.bootcss.com/Swiper/4.0.6/js/swiper.min.js"></script> 
 	 <script src="/resources/js/domainManager.js"></script> 
	<script  src="/resources/js/base.js"></script>

	<script>
	$(function(){
	//第一个swiper
	var swiper = new Swiper('.swiper-container', {
      /* slidesPerView: 3,
      spaceBetween: 0,
      freeMode: true, */
       slidesPerView: 4,
      spaceBetween:10,
      freeMode: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
    });
	  	//获取data-src
		$("img").each(function(){
			if($(this).attr("data-src")){
				$(this).attr("src",$(this).attr("data-src"));
			}
		});
		
	});
    	var detailsApp=angular.module('detailsApp',[]);
    	detailsApp.filter("dateDiff",function(){
                return function(dateTimeStamp){
                    return myUtils.getDateDiff(dateTimeStamp);
                }
            });
           detailsApp.directive('onFinishRenderFilters', function() {
					return {
					restrict: 'A',
					link: function(scope, element, attr) {
					if(scope.book){
					$("#newsDeatilsBody").css("display","block");
					//setTimeout(function(){
					$(".loadAnimation").css("display","none");
					//},2000);
					
					
					scope.$emit('ngRepeatFinished');
					
					}
					
					}
					};
					}); 
    	detailsApp.controller('detailsCtrl',function($rootScope,$scope,$sce){
    	$scope.wapName="小说";
    	$scope.originDomain=domainManager.BookStore;
    	$scope.bookChapterStartNumber=myUtils.GetQueryString("startNumber")||1;//默认开始章节
    	$scope.bookChapterEndNumber=myUtils.GetQueryString("endNumber")||1;//默认结束章节
    	
    			
		//正文小说
    		function initData(bookId,startNumber,endNumber){
  		         
  		          //加载小说 
    			$.ajax({  
  		          type : "get",  
  		          url : "http://"+$scope.originDomain+"/bookChapter/listAll?bookId="+bookId+"&startNumber="+startNumber+"&endNumber="+endNumber,  
  		         // url : "/school/"+id,  
  		          async : false,  
  		          success : function(data){
  		        	console.log(data);
  		        	if(data.code==40000){
  		        	//myUtils.myTemplate("没有更多章节！"+
  		        	//"<br><br><br><br><br><div><button class='btn btn-success' id='openAppId''>点击下载APP，阅读更多章节</button></div>");
  		        	
  		        	//$("#myTemplateNo").remove();
  		        	//$("#myTemplate").css({"width":"100%","height":"100%","margin":"0","top":"0","left":"0"});
  		        	return;
  		        	}
  		        	//data.list[0].content=$sce.trustAsHtml(data.list[0].content);
    				$scope.bookChapter=data.list[0];
  		          }  
  		          });  
    			
    			
    		}
    			var num=1;
    			//阅读
            	function getWebRead(bookId,tgAcountId){
    		 var uv=0;//默认为0不是独立访客，没有uv,1为有uv
            	 //只有不存在，才是新访客
            	if(!myUtils.getCookie("bookUv"+myUtils.GetQueryString("bookId"))){
            		myUtils.setCookie("bookUv"+myUtils.GetQueryString("bookId"), myUtils.GetQueryString("bookId"), myUtils.currentToEndTime());
            		uv=1;
            	}
            		$.ajax({  
  		          type : "post",  
  		          url : "http://"+$scope.originDomain+"/book/webRead", 
  		          data:{
  		          bookId:bookId,
  		          acountId:tgAcountId,
  		          uv:uv
  		          }, 
  		          success : function(data){
  		         if(data.code!=200){
  		         num++;
  		         if(num<=3){
  		         getWebRead(myUtils.GetQueryString("bookId"),tgAcountId);
  		         }
  		         return;
  		         }
  		          }  
  		          });
  		          }
    		var tgAcountId=myUtils.GetQueryString("acountId")||1000;
    		 getWebRead(myUtils.GetQueryString("bookId"),tgAcountId);//点击数据
    		 initData(myUtils.GetQueryString("bookId")||38,$scope.bookChapterStartNumber,$scope.bookChapterEndNumber);//小说加载
    		
    		
    		
    		//自定义的template打开app
		function openApp(){
		//var bookId=myUtils.GetQueryString("bookId");
		if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
		    //window.location = "http://a.app.qq.com/o/simple.jsp?pkgname=com.yufa.zhuanzhuan";
		  	//window.location = "seven://app.com/openwith?bookId="+bookId;
		  	window.location = "seven://app.com/openwith";
		  	setTimeout(function(){
		   window.location = "http://a.app.qq.com/o/simple.jsp?pkgname=com.yufa.zhuanzhuan";
		  	},1000);
		    }else if (navigator.userAgent.match(/android/i)) {
		    //window.location = "seven://app.com/openwith?bookId="+bookId;
		  	window.location = "seven://app.com/openwith";
		  	setTimeout(function(){
		   window.location = "http://a.app.qq.com/o/simple.jsp?pkgname=com.yufa.zhuanzhuan";
		  	},1000);
		    }
		}
    		//小说上一章-1，下一章1
    		$scope.goBookChapter=function(t){
    		$scope.bookChapterStartNumber=parseInt($scope.bookChapterStartNumber)+t;
    		$scope.bookChapterEndNumber=parseInt($scope.bookChapterEndNumber)+t;
    		//是否存在
    		$.ajax({  
  		          type : "post",  
  		          url : "http://"+$scope.originDomain+"/bookChapter/count?bookId="+myUtils.GetQueryString("bookId")+"&number="+$scope.bookChapterStartNumber, 
  		          success : function(data){
  		          if(data>=1){
    		console.log($scope.bookChapterEndNumber)
    		location.href="http://"+location.host+"/book.html?bookId="+myUtils.GetQueryString("bookId")+"&startNumber="+$scope.bookChapterStartNumber+"&endNumber="+$scope.bookChapterEndNumber;
  		          }else{
  		          //复原
  		          $scope.bookChapterStartNumber=parseInt($scope.bookChapterStartNumber)-t;
    			  $scope.bookChapterEndNumber=parseInt($scope.bookChapterEndNumber)-t;
    			  	myUtils.myTemplate("没有更多章节！"+
  		        	"<br><br><br><br><br><div><button class='btn btn-success' id='openAppId''>点击下载APP，阅读更多章节</button></div>");
  		        	
  		        	$("#myTemplate").css({"width":"100%","height":"100%","margin":"0","top":"0","left":"0"});
  		         console.log(1112)
					$("#openAppId").on("click",function(){
					console.log(111)
						openApp();
					});
  		          }
  		          }  
  		          });
    		 //initData(myUtils.GetQueryString("bookId"),parseInt(myUtils.GetQueryString("startNumber"))+t,parseInt(myUtils.GetQueryString("endNumber"))+t);//小说加载
    		};
    		$scope.initRecommendDataList=function(a){
    		var url="http://"+$scope.originDomain+"/book/list?status="+a.status+"&pageNum="+a.pageNum+"&pageSize="+a.pageSize+"&orderName="+a.orderName+"&orderWay="+a.orderWay+"";
    		var bookList="bookList";
    		if(a.recommend){
    		url+="&recommend="+a.recommend;
    		bookList="recommend"+a.recommend+"BookList";//recommend2BookList
    		}
    		$.ajax({  
    		          type : "get",  
    		          url : url,  
    		          async : false,  
    		          success : function(data){
    		          if(data.list.length<=0){
    		          $(".loadAnimation").hide();
    		          	return;
    		          }
    		        	  if(a.pageNum>1){
    		        		  for (var int = 0; int < data.length; int++) {
    		        			
    		        			$scope[bookList].push(data.list[int]); 
    		        			$scope[bookList].push(data.list[int]); 
							}
    		        	  }else{
    		        	  $scope[bookList]=data.list; 
    		        		   
    		        	  } 
    		        	  myUtils.myPrevToast("加载完成", null, "remove");
    		          }  
    		          });  
    		};
    		
    		
    		$scope.noMore=false;//false还有，true没有更多
    		$scope.pageNum=1;//第多少个
    		$scope.pageSize=9;//每页个数
    		$scope.status="1";//初始化状态
    		$scope.recommend=2;//默认好书
    		
    		//recommend 推荐，默认0不推，1封推，2精推，3优推
    			$scope.initRecommendDataList({
    			pageNum:$scope.pageNum,
    			pageSize:$scope.pageSize,
    			status:$scope.status,
    			recommend:$scope.recommend,
    			orderName:"create_date",
    			orderWay:"desc"
    			});
    		
    		//跳转页面
    		$scope.goRedirectUrl=function(bookId){
    			//跳回book.html
    			url="http://"+location.host+"/book.html?bookId="+bookId+"&acountId=1000";
    			location.replace(url);
    		};
		//打开App或小说
		$scope.clickBook=function(book){
		//if($scope.showBookListRule(book)){
		//   $scope.openApp(book);
		//}else{
		$scope.goRedirectUrl(book.bookId);
		//}
		};
		//打开app
		$scope.openApp=function(book){
		   if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
		    //window.location = "http://a.app.qq.com/o/simple.jsp?pkgname=com.yufa.zhuanzhuan";
		  	window.location = "seven://app.com/openwith?bookId="+book.bookId;
		  	setTimeout(function(){
		   window.location = "http://a.app.qq.com/o/simple.jsp?pkgname=com.yufa.zhuanzhuan";
		  	},1000);
		    }else if (navigator.userAgent.match(/android/i)) {
		  	window.location = "seven://app.com/openwith?bookId="+book.bookId;
		  	setTimeout(function(){
		   window.location = "http://a.app.qq.com/o/simple.jsp?pkgname=com.yufa.zhuanzhuan";
		  	},1000);
		    }
		};
    	//显示规则
    	$scope.showBookListRule=function(book){
    	return (book.bookId)%3==0;
    	};
    	});
    	
   </script>
</body>
</html>
